import{_ as e,c as t,w as a,n as s,v as l,$ as n,i as o,o as r,a as c,b as d,d as i,e as u,t as h,S as g,f,F as C,r as y,g as w,h as k,l as _,P as D,q as m}from"./index-sFHZ-OT3.js";import{d as p}from"./db.Cc0ive14.js";const b=e({name:"Calendar",data:()=>({user:{id:1,nickname:"å¼ ä¸‰"},currentYear:2025,currentMonth:1,selectedDate:null,weekDays:["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],calendarDays:[],countdowns:[],categories:[],selectedCountdowns:[],drawerVisible:!1,monthPickerVisible:!1,pickerValue:[0,0],years:[],months:[1,2,3,4,5,6,7,8,9,10,11,12]}),computed:{selectedDateDisplay(){if(!this.selectedDate)return"";const e=new Date(this.selectedDate);return`${e.getFullYear()}å¹´${e.getMonth()+1}æœˆ${e.getDate()}æ—¥ æ˜ŸæœŸ${["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][e.getDay()]}`}},onShow(){this.initData()},methods:{initData(){const e=p.getCurrentUser();e&&(this.user=e);const t=new Date;this.currentYear=t.getFullYear(),this.currentMonth=t.getMonth()+1,this.initYears(),this.loadCategories(),this.loadCountdowns(),this.generateCalendar()},initYears(){const e=(new Date).getFullYear();for(let t=e-10;t<=e+10;t++)this.years.push(t);this.pickerValue=[10,this.currentMonth-1]},loadCategories(){this.user.id&&(this.categories=p.getCategories(this.user.id))},loadCountdowns(){this.user.id&&(this.countdowns=p.getCountdowns(this.user.id))},generateCalendar(){const e=this.currentYear,t=this.currentMonth,a=new Date(e,t-1,1),s=new Date(e,t,0).getDate(),l=a.getDay(),n=new Date(e,t-1,0).getDate(),o=[];for(let i=l-1;i>=0;i--){const a=n-i,s=this.formatDate(e,t-1,a);o.push({day:a,dateStr:s,isCurrentMonth:!1,isToday:!1,isSelected:!1,hasCountdown:this.hasCountdownOnDate(s),colors:this.getCountdownColors(s)})}const r=new Date,c=this.formatDate(r.getFullYear(),r.getMonth()+1,r.getDate());for(let i=1;i<=s;i++){const a=this.formatDate(e,t,i);o.push({day:i,dateStr:a,isCurrentMonth:!0,isToday:a===c,isSelected:a===this.selectedDate,hasCountdown:this.hasCountdownOnDate(a),colors:this.getCountdownColors(a)})}const d=42-o.length;for(let i=1;i<=d;i++){const a=this.formatDate(e,t+1,i);o.push({day:i,dateStr:a,isCurrentMonth:!1,isToday:!1,isSelected:!1,hasCountdown:this.hasCountdownOnDate(a),colors:this.getCountdownColors(a)})}this.calendarDays=o},formatDate:(e,t,a)=>(0===t?(e-=1,t=12):13===t&&(e+=1,t=1),`${e}-${String(t).padStart(2,"0")}-${String(a).padStart(2,"0")}`),hasCountdownOnDate(e){return this.countdowns.some(t=>t.date===e)},getCountdownColors(e){const t=this.countdowns.filter(t=>t.date===e),a=[];return t.forEach(e=>{const t=this.categories.find(t=>t.id===e.categoryId);t&&a.length<3&&a.push(t.color)}),a},handleDayClick(e){e.isCurrentMonth&&(this.selectedDate=e.dateStr,this.generateCalendar(),this.loadSelectedCountdowns())},loadSelectedCountdowns(){this.selectedDate?this.selectedCountdowns=this.countdowns.filter(e=>e.date===this.selectedDate):this.selectedCountdowns=[]},prevMonth(){1===this.currentMonth?(this.currentYear-=1,this.currentMonth=12):this.currentMonth-=1,this.generateCalendar()},nextMonth(){12===this.currentMonth?(this.currentYear+=1,this.currentMonth=1):this.currentMonth+=1,this.generateCalendar()},goToday(){const e=new Date;this.currentYear=e.getFullYear(),this.currentMonth=e.getMonth()+1,this.selectedDate=this.formatDate(this.currentYear,this.currentMonth,e.getDate()),this.generateCalendar(),this.loadSelectedCountdowns()},showMonthPicker(){const e=this.years.indexOf(this.currentYear);this.pickerValue=[e,this.currentMonth-1],this.monthPickerVisible=!0},onPickerChange(e){this.pickerValue=e.detail.value},confirmMonthPicker(){this.currentYear=this.years[this.pickerValue[0]],this.currentMonth=this.months[this.pickerValue[1]],this.monthPickerVisible=!1,this.generateCalendar()},calculateDays(e){const t=p.calculateDays(e);return t>0?`è¿˜æœ‰ ${t}`:t<0?`å·²è¿‡ ${Math.abs(t)}`:"ä»Šå¤©"},getCategoryColor(e){const t=this.categories.find(t=>t.id===e);return t?t.color:"#ff6b9d"},getCategoryIcon(e){const t=this.categories.find(t=>t.id===e);return t?t.icon:"ðŸ“‹"},getCategoryName(e){const t=this.categories.find(t=>t.id===e);return t?t.name:"æœªåˆ†ç±»"},getCategoryCount(e){return this.countdowns.filter(t=>t.categoryId===e).length},getAllCountdownCount(){return this.countdowns.length},toggleDrawer(){this.drawerVisible=!this.drawerVisible},handleCategoryClick(e){this.drawerVisible=!1,l({url:"/pages/categories/categories"}),setTimeout(()=>{n("selectCategory",{categoryId:e.id})},100)},handleAllCategoryClick(){this.drawerVisible=!1,l({url:"/pages/index/index"})},goToEventEdit(){const e=this.selectedDate||this.formatDate((new Date).getFullYear(),(new Date).getMonth()+1,(new Date).getDate());s({url:"/pages/event-edit/event-edit"+(this.selectedDate?"?date="+e:"")})},handleCountdownClick(e){s({url:`/pages/detail/detail?id=${e.id}`})}}},[["render",function(e,s,l,n,p,b){const M=i,V=o,Y=g,v=m,S=D;return r(),t(V,{class:"page-container"},{default:a(()=>[c(V,{class:"navbar"},{default:a(()=>[c(V,{class:"navbar-icon",onClick:b.toggleDrawer},{default:a(()=>[c(M,null,{default:a(()=>[u("â˜°")]),_:1})]),_:1},8,["onClick"]),c(V,{class:"navbar-title"},{default:a(()=>[c(M,null,{default:a(()=>[u(h(p.user.nickname)+"çš„æ—¥åŽ†",1)]),_:1})]),_:1}),c(V,{class:"navbar-icon",onClick:b.goToEventEdit},{default:a(()=>[c(M,null,{default:a(()=>[u("+")]),_:1})]),_:1},8,["onClick"])]),_:1}),c(Y,{"scroll-y":"",class:"page-content"},{default:a(()=>[c(V,{class:"calendar-header"},{default:a(()=>[c(V,{class:"month-selector"},{default:a(()=>[c(V,{class:"month-btn",onClick:b.prevMonth},{default:a(()=>[c(M,null,{default:a(()=>[u("â€¹")]),_:1})]),_:1},8,["onClick"]),c(V,{class:"month-display",onClick:b.showMonthPicker},{default:a(()=>[c(M,{class:"month-text"},{default:a(()=>[u(h(p.currentYear)+"å¹´"+h(p.currentMonth)+"æœˆ",1)]),_:1})]),_:1},8,["onClick"]),c(V,{class:"month-btn",onClick:b.nextMonth},{default:a(()=>[c(M,null,{default:a(()=>[u("â€º")]),_:1})]),_:1},8,["onClick"])]),_:1}),c(V,{class:"today-btn",onClick:b.goToday},{default:a(()=>[c(M,null,{default:a(()=>[u("ä»Šå¤©")]),_:1})]),_:1},8,["onClick"])]),_:1}),c(V,{class:"calendar-weekdays"},{default:a(()=>[(r(!0),f(C,null,y(p.weekDays,(e,s)=>(r(),t(V,{key:s,class:"weekday-item"},{default:a(()=>[c(M,null,{default:a(()=>[u(h(e),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),c(V,{class:"calendar-grid"},{default:a(()=>[(r(!0),f(C,null,y(p.calendarDays,(e,s)=>(r(),t(V,{key:s,class:"calendar-day-wrapper",onClick:t=>b.handleDayClick(e)},{default:a(()=>[c(V,{class:w(["calendar-day",{"day-other-month":!e.isCurrentMonth,"day-today":e.isToday,"day-selected":e.isSelected,"day-has-countdown":e.hasCountdown}])},{default:a(()=>[c(M,{class:"day-number"},{default:a(()=>[u(h(e.day),1)]),_:2},1024),e.hasCountdown?(r(),t(V,{key:0,class:"day-dots"},{default:a(()=>[(r(!0),f(C,null,y(e.colors,(e,a)=>(r(),t(V,{key:a,class:"day-dot",style:k({backgroundColor:e})},null,8,["style"]))),128))]),_:2},1024)):d("",!0)]),_:2},1032,["class"])]),_:2},1032,["onClick"]))),128))]),_:1}),p.selectedCountdowns.length>0?(r(),t(V,{key:0,class:"countdown-list-section"},{default:a(()=>[c(V,{class:"section-title"},{default:a(()=>[c(M,null,{default:a(()=>[u(h(b.selectedDateDisplay)+"çš„å€’æ•°æ—¥",1)]),_:1})]),_:1}),c(V,{class:"countdown-list"},{default:a(()=>[(r(!0),f(C,null,y(p.selectedCountdowns,e=>(r(),t(V,{key:e.id,class:"countdown-item shadow",onClick:t=>b.handleCountdownClick(e)},{default:a(()=>[c(V,{class:"countdown-color-bar",style:k({backgroundColor:b.getCategoryColor(e.categoryId)})},null,8,["style"]),c(V,{class:"countdown-content"},{default:a(()=>[c(V,{class:"countdown-left"},{default:a(()=>[c(V,{class:"countdown-icon",style:k({backgroundColor:b.getCategoryColor(e.categoryId)})},{default:a(()=>[c(M,null,{default:a(()=>[u(h(b.getCategoryIcon(e.categoryId)),1)]),_:2},1024)]),_:2},1032,["style"]),c(V,{class:"countdown-info"},{default:a(()=>[c(M,{class:"countdown-title"},{default:a(()=>[u(h(e.title),1)]),_:2},1024),c(M,{class:"countdown-category"},{default:a(()=>[u(h(b.getCategoryName(e.categoryId)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),c(V,{class:"countdown-right"},{default:a(()=>[c(M,{class:"countdown-days"},{default:a(()=>[u(h(b.calculateDays(e.date)),1)]),_:2},1024),c(M,{class:"countdown-unit"},{default:a(()=>[u("å¤©")]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})):p.selectedDate?(r(),t(V,{key:1,class:"empty-state"},{default:a(()=>[c(M,{class:"empty-icon"},{default:a(()=>[u("ðŸ“…")]),_:1}),c(M,{class:"empty-text"},{default:a(()=>[u("è¿™å¤©è¿˜æ²¡æœ‰å€’æ•°æ—¥")]),_:1}),c(V,{class:"btn btn-primary",onClick:b.goToEventEdit},{default:a(()=>[c(M,null,{default:a(()=>[u("æ·»åŠ å€’æ•°æ—¥")]),_:1})]),_:1},8,["onClick"])]),_:1})):d("",!0),c(V,{style:{height:"40rpx"}})]),_:1}),p.drawerVisible?(r(),t(V,{key:0,class:"drawer-mask",onClick:b.toggleDrawer},null,8,["onClick"])):d("",!0),c(V,{class:w(["drawer",{"drawer-open":p.drawerVisible}])},{default:a(()=>[c(V,{class:"drawer-header"},{default:a(()=>[c(M,{class:"drawer-title"},{default:a(()=>[u("å€’æ•°æœ¬")]),_:1}),c(V,{class:"drawer-close",onClick:b.toggleDrawer},{default:a(()=>[c(M,null,{default:a(()=>[u("âœ•")]),_:1})]),_:1},8,["onClick"])]),_:1}),c(Y,{"scroll-y":"",class:"drawer-content"},{default:a(()=>[c(V,{class:"category-list"},{default:a(()=>[c(V,{class:"category-drawer-item",onClick:b.handleAllCategoryClick},{default:a(()=>[c(V,{class:"category-drawer-icon",style:{"background-color":"#ff6b9d"}},{default:a(()=>[c(M,null,{default:a(()=>[u("ðŸ“‹")]),_:1})]),_:1}),c(M,{class:"category-drawer-name"},{default:a(()=>[u("å…¨éƒ¨")]),_:1}),c(M,{class:"category-drawer-count"},{default:a(()=>[u(h(b.getAllCountdownCount()),1)]),_:1})]),_:1},8,["onClick"]),(r(!0),f(C,null,y(p.categories,e=>(r(),t(V,{key:e.id,class:"category-drawer-item",onClick:t=>b.handleCategoryClick(e)},{default:a(()=>[c(V,{class:"category-drawer-icon",style:k({backgroundColor:e.color})},{default:a(()=>[c(M,null,{default:a(()=>[u(h(e.icon),1)]),_:2},1024)]),_:2},1032,["style"]),c(M,{class:"category-drawer-name"},{default:a(()=>[u(h(e.name),1)]),_:2},1024),c(M,{class:"category-drawer-count"},{default:a(()=>[u(h(b.getCategoryCount(e.id)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1},8,["class"]),p.monthPickerVisible?(r(),t(V,{key:1,class:"modal-mask",onClick:s[3]||(s[3]=e=>p.monthPickerVisible=!1)},{default:a(()=>[c(V,{class:"picker-content",onClick:s[2]||(s[2]=_(()=>{},["stop"]))},{default:a(()=>[c(V,{class:"picker-header"},{default:a(()=>[c(M,{class:"picker-title"},{default:a(()=>[u("é€‰æ‹©å¹´æœˆ")]),_:1}),c(V,{class:"picker-close",onClick:s[0]||(s[0]=e=>p.monthPickerVisible=!1)},{default:a(()=>[c(M,null,{default:a(()=>[u("âœ•")]),_:1})]),_:1})]),_:1}),c(V,{class:"picker-body"},{default:a(()=>[c(S,{value:p.pickerValue,onChange:b.onPickerChange,class:"picker-view"},{default:a(()=>[c(v,null,{default:a(()=>[(r(!0),f(C,null,y(p.years,(e,s)=>(r(),t(V,{key:s,class:"picker-item"},{default:a(()=>[c(M,null,{default:a(()=>[u(h(e)+"å¹´",1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),c(v,null,{default:a(()=>[(r(!0),f(C,null,y(p.months,(e,s)=>(r(),t(V,{key:s,class:"picker-item"},{default:a(()=>[c(M,null,{default:a(()=>[u(h(e)+"æœˆ",1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["value","onChange"])]),_:1}),c(V,{class:"picker-footer"},{default:a(()=>[c(V,{class:"btn btn-ghost",onClick:s[1]||(s[1]=e=>p.monthPickerVisible=!1)},{default:a(()=>[c(M,null,{default:a(()=>[u("å–æ¶ˆ")]),_:1})]),_:1}),c(V,{class:"btn btn-primary",onClick:b.confirmMonthPicker},{default:a(()=>[c(M,null,{default:a(()=>[u("ç¡®å®š")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})):d("",!0)]),_:1})}],["__scopeId","data-v-87f3090b"]]);export{b as default};
