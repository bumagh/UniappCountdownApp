import{_ as e,c as t,w as a,s,k as i,D as o,j as n,i as r,o as l,a as c,b as d,d as u,e as f,t as p,S as h,I as m,m as g,f as D,F as y,r as C,g as _,h as k,p as b,E as I}from"./index-sFHZ-OT3.js";import{d as F}from"./db.Cc0ive14.js";const w=e({name:"Edit",data(){return{countdownId:null,isEdit:!1,formData:{title:"",date:this.getCurrentDate(),categoryId:null,isPinned:!1,repeatCycle:0,repeatFrequency:"ä¸é‡å¤"},categories:[],repeatOptions:["ä¸é‡å¤","æ¯å¤©","æ¯å‘¨","æ¯æœˆ","æ¯å¹´","æ¯2å¤©","æ¯3å¤©","æ¯4å¤©","æ¯5å¤©","æ¯6å¤©","æ¯7å¤©","æ¯2å‘¨","æ¯3å‘¨","æ¯2æœˆ","æ¯3æœˆ","æ¯6æœˆ","æ¯2å¹´","æ¯3å¹´","æ¯5å¹´"],repeatOption:"",isRepeatEnabled:!1}},computed:{minDate(){const e=new Date;return e.setFullYear(e.getFullYear()-10),e.toISOString().split("T")[0]},maxDate(){const e=new Date;return e.setFullYear(e.getFullYear()+10),e.toISOString().split("T")[0]}},onLoad(e){e.id?(this.countdownId=parseInt(e.id),this.isEdit=!0,this.loadCountdownData()):this.loadCategories()},methods:{getCurrentDate(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},loadCountdownData(){const e=F.getCountdown(this.countdownId);e&&(this.formData={title:e.title,date:e.date,categoryId:e.categoryId,isPinned:e.isPinned||!1,repeatCycle:e.repeatCycle||0,repeatFrequency:e.repeatFrequency||"ä¸é‡å¤"},this.checkRepeatEnabled(),this.setRepeatOption()),this.loadCategories()},loadCategories(){const e=F.getCurrentUser();e&&(this.categories=F.getCategories(e.id),this.categories.length>0&&!this.formData.categoryId&&(this.formData.categoryId=this.categories[0].id))},checkRepeatEnabled(){this.isRepeatEnabled=this.formData.repeatCycle>0&&"ä¸é‡å¤"!==this.formData.repeatFrequency},setRepeatOption(){0===this.formData.repeatCycle||"ä¸é‡å¤"===this.formData.repeatFrequency?this.repeatOption="ä¸é‡å¤":this.repeatOption=F.getRepeatText(this.formData.repeatCycle,this.formData.repeatFrequency)},onDateChange(e){this.formData.date=e.detail.value},selectCategory(e){this.formData.categoryId=e},onPinnedChange(e){this.formData.isPinned=e.detail.value},toggleRepeat(e){this.isRepeatEnabled=e.detail.value,this.isRepeatEnabled?(this.repeatOption="æ¯å¤©",this.formData.repeatCycle=1,this.formData.repeatFrequency="å¤©é‡å¤"):(this.repeatOption="ä¸é‡å¤",this.formData.repeatCycle=0,this.formData.repeatFrequency="ä¸é‡å¤")},showRepeatOptions(){n({itemList:this.repeatOptions,success:e=>{this.repeatOption=this.repeatOptions[e.tapIndex],this.parseRepeatOption(this.repeatOption)}})},parseRepeatOption(e){if("ä¸é‡å¤"===e)this.formData.repeatCycle=0,this.formData.repeatFrequency="ä¸é‡å¤";else if("æ¯å¤©"===e)this.formData.repeatCycle=1,this.formData.repeatFrequency="å¤©é‡å¤";else if("æ¯å‘¨"===e)this.formData.repeatCycle=1,this.formData.repeatFrequency="å‘¨é‡å¤";else if("æ¯æœˆ"===e)this.formData.repeatCycle=1,this.formData.repeatFrequency="æœˆé‡å¤";else if("æ¯å¹´"===e)this.formData.repeatCycle=1,this.formData.repeatFrequency="å¹´é‡å¤";else if(e.includes("æ¯")){const t=e.match(/æ¯(\d+)(å¤©|å‘¨|æœˆ|å¹´)/);t&&(this.formData.repeatCycle=parseInt(t[1]),this.formData.repeatFrequency=t[2]+"é‡å¤")}},getRepeatText(){return"ä¸é‡å¤"===this.repeatOption?"ä¸é‡å¤":this.repeatOption},formatDateDisplay(e){if(!e)return"";const t=new Date(e);return`${t.getFullYear()}å¹´${t.getMonth()+1}æœˆ${t.getDate()}æ—¥ æ˜ŸæœŸ${["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][t.getDay()]}`},goBack(){o({delta:1})},handleArchive(){i({title:"ç¡®è®¤å½’æ¡£",content:`ç¡®å®šè¦å½’æ¡£ã€Œ${this.formData.title}ã€å—ï¼Ÿå½’æ¡£åŽå¯åœ¨"æˆ‘çš„"æ¨¡å—ä¸­æŸ¥çœ‹ã€‚`,confirmText:"å½’æ¡£",success:e=>{if(e.confirm)try{F.archiveCountdown(this.countdownId),s({title:"å½’æ¡£æˆåŠŸ",icon:"success"}),setTimeout(()=>{this.goBack()},1e3)}catch(t){s({title:"å½’æ¡£å¤±è´¥",icon:"none"})}}})},handleDelete(){i({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå€’æ•°æ—¥å—ï¼Ÿ",success:e=>{if(e.confirm)try{F.deleteCountdown(this.countdownId),s({title:"åˆ é™¤æˆåŠŸ",icon:"success"}),this.goBack()}catch(t){s({title:"åˆ é™¤å¤±è´¥",icon:"none"})}}})},handleSubmit(){if(!this.formData.title.trim())return void s({title:"è¯·è¾“å…¥æ—¥ç¨‹åç§°",icon:"none"});if(!this.formData.date)return void s({title:"è¯·é€‰æ‹©æ—¥æœŸ",icon:"none"});if(!this.formData.categoryId)return void s({title:"è¯·é€‰æ‹©åˆ†ç±»",icon:"none"});const e=F.getCurrentUser();if(e)try{this.isEdit?(F.updateCountdown(this.countdownId,{title:this.formData.title,date:this.formData.date,categoryId:this.formData.categoryId,isPinned:this.formData.isPinned,repeatCycle:this.formData.repeatCycle,repeatFrequency:this.formData.repeatFrequency}),s({title:"ä¿®æ”¹æˆåŠŸ",icon:"success"})):(F.addCountdown({title:this.formData.title,date:this.formData.date,categoryId:this.formData.categoryId,userId:e.id,isPinned:this.formData.isPinned,repeatCycle:this.formData.repeatCycle,repeatFrequency:this.formData.repeatFrequency}),s({title:"æ·»åŠ æˆåŠŸ",icon:"success"})),setTimeout(()=>{this.goBack()},1e3)}catch(t){s({title:"æ“ä½œå¤±è´¥",icon:"none"})}else s({title:"ç”¨æˆ·ä¿¡æ¯èŽ·å–å¤±è´¥",icon:"none"})}}},[["render",function(e,s,i,o,n,F){const w=u,O=r,R=m,q=g,v=b,E=I,x=h;return l(),t(O,{class:"page-container"},{default:a(()=>[c(O,{class:"navbar"},{default:a(()=>[c(O,{class:"navbar-icon",onClick:F.goBack},{default:a(()=>[c(w,null,{default:a(()=>[f("â€¹")]),_:1})]),_:1},8,["onClick"]),c(O,{class:"navbar-title"},{default:a(()=>[c(w,null,{default:a(()=>[f(p(n.isEdit?"ç¼–è¾‘å€’æ•°æ—¥":"æ·»åŠ å€’æ•°æ—¥"),1)]),_:1})]),_:1}),c(O,{class:"navbar-icon",onClick:F.handleSubmit},{default:a(()=>[c(w,null,{default:a(()=>[f("âœ“")]),_:1})]),_:1},8,["onClick"])]),_:1}),c(x,{"scroll-y":"",class:"page-content"},{default:a(()=>[c(O,{class:"form-container"},{default:a(()=>[c(O,{class:"form-item"},{default:a(()=>[c(w,{class:"form-label"},{default:a(()=>[f("æ—¥ç¨‹åç§°")]),_:1}),c(R,{class:"form-input",modelValue:n.formData.title,"onUpdate:modelValue":s[0]||(s[0]=e=>n.formData.title=e),placeholder:"è¯·è¾“å…¥æ—¥ç¨‹åç§°",maxlength:"20"},null,8,["modelValue"])]),_:1}),c(O,{class:"form-item"},{default:a(()=>[c(w,{class:"form-label"},{default:a(()=>[f("é€‰æ‹©æ—¥æœŸ")]),_:1}),c(O,{class:"date-picker-container"},{default:a(()=>[c(q,{mode:"date",value:n.formData.date,onChange:F.onDateChange,start:F.minDate,end:F.maxDate,class:"date-picker"},{default:a(()=>[c(O,{class:"date-input"},{default:a(()=>[n.formData.date?(l(),t(w,{key:0,class:"date-text"},{default:a(()=>[f(p(F.formatDateDisplay(n.formData.date)),1)]),_:1})):(l(),t(w,{key:1,class:"date-placeholder"},{default:a(()=>[f("è¯·é€‰æ‹©æ—¥æœŸ")]),_:1})),c(w,{class:"date-icon"},{default:a(()=>[f("ðŸ“…")]),_:1})]),_:1})]),_:1},8,["value","onChange","start","end"])]),_:1})]),_:1}),c(O,{class:"form-item"},{default:a(()=>[c(w,{class:"form-label"},{default:a(()=>[f("é€‰æ‹©åˆ†ç±»")]),_:1}),c(O,{class:"category-list"},{default:a(()=>[(l(!0),D(y,null,C(n.categories,e=>(l(),t(O,{key:e.id,class:_(["category-item",{"category-active":n.formData.categoryId===e.id}]),onClick:t=>F.selectCategory(e.id)},{default:a(()=>[c(O,{class:"category-icon",style:k({backgroundColor:e.color})},{default:a(()=>[c(w,{class:"icon-text"},{default:a(()=>[f(p(e.icon),1)]),_:2},1024)]),_:2},1032,["style"]),c(w,{class:"category-name"},{default:a(()=>[f(p(e.name),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),c(O,{class:"form-item"},{default:a(()=>[c(O,{class:"form-label-row"},{default:a(()=>[c(w,{class:"form-label"},{default:a(()=>[f("ç½®é¡¶æ˜¾ç¤º")]),_:1}),c(v,{checked:n.formData.isPinned,onChange:F.onPinnedChange,color:"#1890ff"},null,8,["checked","onChange"])]),_:1})]),_:1}),c(O,{class:"form-item"},{default:a(()=>[c(O,{class:"form-label-row"},{default:a(()=>[c(w,{class:"form-label"},{default:a(()=>[f("é‡å¤è®¾ç½®")]),_:1}),c(v,{checked:n.isRepeatEnabled,onChange:F.toggleRepeat,color:"#1890ff"},null,8,["checked","onChange"])]),_:1})]),_:1}),n.isRepeatEnabled?(l(),t(O,{key:0,class:"repeat-selector-section"},{default:a(()=>[c(O,{class:"repeat-button-wrapper"},{default:a(()=>[c(E,{class:"repeat-button",onClick:F.showRepeatOptions},{default:a(()=>[f(p(n.repeatOption||"è¯·é€‰æ‹©é‡å¤é¢‘çŽ‡"),1)]),_:1},8,["onClick"])]),_:1}),c(O,{class:"repeat-hint"},{default:a(()=>[c(w,null,{default:a(()=>[f("å½“å‰è®¾ç½®ï¼š"+p(F.getRepeatText()),1)]),_:1})]),_:1})]),_:1})):d("",!0)]),_:1}),c(O,{style:{height:"40rpx"}})]),_:1}),n.isEdit?(l(),t(O,{key:0,class:"danger-section"},{default:a(()=>[c(O,{class:"danger-actions"},{default:a(()=>[c(O,{class:"btn btn-archive",onClick:F.handleArchive},{default:a(()=>[c(w,null,{default:a(()=>[f("å½’æ¡£")]),_:1})]),_:1},8,["onClick"]),c(O,{class:"btn btn-danger",onClick:F.handleDelete},{default:a(()=>[c(w,null,{default:a(()=>[f("åˆ é™¤")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})):d("",!0)]),_:1})}],["__scopeId","data-v-a9a00468"]]);export{w as default};
