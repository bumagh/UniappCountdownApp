import{_ as e,c as a,w as t,k as l,j as s,s as c,x as n,y as i,z as d,A as o,n as u,B as r,i as f,o as m,a as h,b as _,d as g,e as k,t as C,S as v,C as b,p as w,g as p,f as y,F as A,r as N,h as S,l as D,I as V}from"./index-sFHZ-OT3.js";import{d as I}from"./db.Cc0ive14.js";const M=e({name:"Profile",data:()=>({user:{id:1,nickname:"å¼ ä¸‰",avatar:"https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=200&h=200&fit=crop"},countdownStats:{total:0,future:0,past:0},reminderEnabled:!0,drawerVisible:!1,categories:[],nicknameModalVisible:!1,newNickname:"",archiveVisible:!1,archivedCountdowns:[],archivedCount:0}),onShow(){this.loadUserData(),this.loadCategories(),this.calculateStats(),this.loadArchivedCountdowns()},methods:{loadUserData(){const e=I.getCurrentUser();if(e){const a=r("user_avatar");a&&(e.avatar=a),this.user=e}},loadCategories(){this.user.id&&(this.categories=I.getCategories(this.user.id))},calculateStats(){if(!this.user.id)return;const e=I.getCountdowns(this.user.id);this.countdownStats.total=e.length;let a=0,t=0;e.forEach(e=>{I.calculateDays(e.date)>=0?a++:t++}),this.countdownStats.future=a,this.countdownStats.past=t},loadArchivedCountdowns(){this.user.id&&(this.archivedCountdowns=I.getArchivedCountdowns(this.user.id),this.archivedCount=this.archivedCountdowns.length)},getCategoryCount(e){return I.getCountdowns(this.user.id,e).length},getCategoryColor(e){const a=this.categories.find(a=>a.id===e);return a?a.color:"#1890ff"},getCategoryIcon(e){const a=this.categories.find(a=>a.id===e);return a?a.icon:"ğŸ“‹"},getCategoryName(e){const a=this.categories.find(a=>a.id===e);return a?a.name:"æœªåˆ†ç±»"},formatDate:e=>I.formatDate(e),toggleDrawer(){this.drawerVisible=!this.drawerVisible},handleCategoryClick(e){this.drawerVisible=!1,u({url:`/pages/categories/categories?categoryId=${e.id}`})},handleAvatarClick(){s({itemList:["ä»ç›¸å†Œé€‰æ‹©","æ‹ç…§","æ¢å¤é»˜è®¤"],success:e=>{0===e.tapIndex?this.chooseFromAlbum():1===e.tapIndex?this.takePhoto():2===e.tapIndex&&this.resetAvatar()}})},chooseFromAlbum(){o({count:1,sizeType:["compressed"],sourceType:["album"],success:e=>{this.updateAvatar(e.tempFilePaths[0])},fail:e=>{c({title:"é€‰æ‹©å¤±è´¥",icon:"none"})}})},takePhoto(){o({count:1,sizeType:["compressed"],sourceType:["camera"],success:e=>{this.updateAvatar(e.tempFilePaths[0])},fail:e=>{c({title:"æ‹ç…§å¤±è´¥",icon:"none"})}})},updateAvatar(e){i({tempFilePath:e,success:e=>{const a=e.savedFilePath;d("user_avatar",a),this.user.avatar=a,I.updateUser(this.user.id,{avatar:a}),c({title:"å¤´åƒæ›´æ–°æˆåŠŸ",icon:"success"})},fail:a=>{d("user_avatar",e),this.user.avatar=e,I.updateUser(this.user.id,{avatar:e}),c({title:"å¤´åƒæ›´æ–°æˆåŠŸ",icon:"success"})}})},resetAvatar(){const e="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=200&h=200&fit=crop";n("user_avatar"),this.user.avatar=e,I.updateUser(this.user.id,{avatar:e}),c({title:"å·²æ¢å¤é»˜è®¤å¤´åƒ",icon:"success"})},handleNicknameEdit(){this.newNickname=this.user.nickname,this.nicknameModalVisible=!0},closeNicknameModal(){this.nicknameModalVisible=!1,this.newNickname=""},saveNickname(){if(!this.newNickname.trim())return void c({title:"æ˜µç§°ä¸èƒ½ä¸ºç©º",icon:"none"});I.updateUser(this.user.id,{nickname:this.newNickname})?(this.user.nickname=this.newNickname,c({title:"ä¿®æ”¹æˆåŠŸ",icon:"success"}),this.closeNicknameModal()):c({title:"ä¿®æ”¹å¤±è´¥",icon:"none"})},handleEmailSetting(){c({title:"åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},handleReminderToggle(e){this.reminderEnabled=e.detail.value,c({title:this.reminderEnabled?"å·²å¼€å¯æé†’":"å·²å…³é—­æé†’",icon:"none"})},handleArchiveManagement(){this.archiveVisible=!0,this.loadArchivedCountdowns()},closeArchive(){this.archiveVisible=!1},handleUnarchive(e){l({title:"ç¡®è®¤æ¢å¤",content:`ç¡®å®šè¦æ¢å¤ã€Œ${e.title}ã€å—ï¼Ÿ`,success:a=>{if(a.confirm){I.unarchiveCountdown(e.id)&&(c({title:"æ¢å¤æˆåŠŸ",icon:"success"}),this.loadArchivedCountdowns(),this.calculateStats())}}})},handleDeleteArchived(e){l({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦æ°¸ä¹…åˆ é™¤ã€Œ${e.title}ã€å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`,confirmColor:"#e54d42",success:a=>{if(a.confirm){I.deleteCountdown(e.id)?(c({title:"åˆ é™¤æˆåŠŸ",icon:"success"}),this.loadArchivedCountdowns()):c({title:"åˆ é™¤å¤±è´¥",icon:"none"})}}})},handleThemeSetting(){c({title:"åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},handleDataManagement(){s({itemList:["å¯¼å‡ºæ•°æ®","å¯¼å…¥æ•°æ®","æ¸…ç©ºæ•°æ®"],success:e=>{2===e.tapIndex?l({title:"è­¦å‘Š",content:"ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼",confirmColor:"#e54d42",success:e=>{e.confirm&&(I.clearAll(),I.initDefaultData(),this.loadUserData(),this.loadCategories(),this.calculateStats(),this.loadArchivedCountdowns(),c({title:"æ•°æ®å·²æ¸…ç©º",icon:"success"}))}}):c({title:"åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})}})},handleAbout(){l({title:"å…³äºæ—¶å…‰å€’æ•°",content:"æ—¶å…‰å€’æ•° v1.0.0\nä¸€æ¬¾ç®€æ´ä¼˜é›…çš„å€’æ•°æ—¥ç®¡ç†å·¥å…·\n\nBy HAISNAP",showCancel:!1})}}},[["render",function(e,l,s,c,n,i){const d=g,o=f,u=b,r=w,I=v,M=V;return m(),a(o,{class:"page-container"},{default:t(()=>[h(o,{class:"navbar"},{default:t(()=>[h(o,{class:"navbar-icon",onClick:i.toggleDrawer},{default:t(()=>[h(d,null,{default:t(()=>[k("â˜°")]),_:1})]),_:1},8,["onClick"]),h(o,{class:"navbar-title"},{default:t(()=>[h(d,null,{default:t(()=>[k(C(n.user.nickname)+"çš„ä¸ªäººä¸­å¿ƒ",1)]),_:1})]),_:1}),h(o,{class:"navbar-icon"})]),_:1}),h(I,{"scroll-y":"",class:"page-content"},{default:t(()=>[h(o,{class:"user-card shadow-lg"},{default:t(()=>[h(o,{class:"user-avatar-wrapper"},{default:t(()=>[h(u,{class:"user-avatar",src:n.user.avatar,mode:"aspectFill",onClick:i.handleAvatarClick},null,8,["src","onClick"]),h(o,{class:"avatar-edit-btn"},{default:t(()=>[h(d,null,{default:t(()=>[k("âœ")]),_:1})]),_:1})]),_:1}),h(o,{class:"user-info"},{default:t(()=>[h(d,{class:"user-nickname"},{default:t(()=>[k(C(n.user.nickname),1)]),_:1}),h(o,{class:"user-stats"},{default:t(()=>[h(o,{class:"stat-item"},{default:t(()=>[h(d,{class:"stat-number"},{default:t(()=>[k(C(n.countdownStats.total),1)]),_:1}),h(d,{class:"stat-label"},{default:t(()=>[k("å€’æ•°æ—¥")]),_:1})]),_:1}),h(o,{class:"stat-divider"}),h(o,{class:"stat-item"},{default:t(()=>[h(d,{class:"stat-number"},{default:t(()=>[k(C(n.countdownStats.future),1)]),_:1}),h(d,{class:"stat-label"},{default:t(()=>[k("æœªæ¥")]),_:1})]),_:1}),h(o,{class:"stat-divider"}),h(o,{class:"stat-item"},{default:t(()=>[h(d,{class:"stat-number"},{default:t(()=>[k(C(n.countdownStats.past),1)]),_:1}),h(d,{class:"stat-label"},{default:t(()=>[k("å·²ç»")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),h(o,{class:"menu-section"},{default:t(()=>[h(o,{class:"menu-title"},{default:t(()=>[h(d,null,{default:t(()=>[k("ä¸ªäººè®¾ç½®")]),_:1})]),_:1}),h(o,{class:"menu-list"},{default:t(()=>[h(o,{class:"menu-item",onClick:i.handleNicknameEdit},{default:t(()=>[h(o,{class:"menu-item-left"},{default:t(()=>[h(o,{class:"menu-icon",style:{"background-color":"#1890ff"}},{default:t(()=>[h(d,null,{default:t(()=>[k("ğŸ‘¤")]),_:1})]),_:1}),h(d,{class:"menu-label"},{default:t(()=>[k("ä¿®æ”¹æ˜µç§°")]),_:1})]),_:1}),h(o,{class:"menu-item-right"},{default:t(()=>[h(d,{class:"menu-value"},{default:t(()=>[k(C(n.user.nickname),1)]),_:1}),h(d,{class:"menu-arrow"},{default:t(()=>[k("â€º")]),_:1})]),_:1})]),_:1},8,["onClick"]),h(o,{class:"menu-item",onClick:i.handleEmailSetting},{default:t(()=>[h(o,{class:"menu-item-left"},{default:t(()=>[h(o,{class:"menu-icon",style:{"background-color":"#1cbbb4"}},{default:t(()=>[h(d,null,{default:t(()=>[k("ğŸ“§")]),_:1})]),_:1}),h(d,{class:"menu-label"},{default:t(()=>[k("é‚®ç®±é€šçŸ¥")]),_:1})]),_:1}),h(o,{class:"menu-item-right"},{default:t(()=>[h(d,{class:"menu-value"},{default:t(()=>[k("æœªè®¾ç½®")]),_:1}),h(d,{class:"menu-arrow"},{default:t(()=>[k("â€º")]),_:1})]),_:1})]),_:1},8,["onClick"]),h(o,{class:"menu-item"},{default:t(()=>[h(o,{class:"menu-item-left"},{default:t(()=>[h(o,{class:"menu-icon",style:{"background-color":"#fbbd08"}},{default:t(()=>[h(d,null,{default:t(()=>[k("ğŸ””")]),_:1})]),_:1}),h(d,{class:"menu-label"},{default:t(()=>[k("æé†’åŠŸèƒ½")]),_:1})]),_:1}),h(o,{class:"menu-item-right"},{default:t(()=>[h(r,{checked:n.reminderEnabled,onChange:i.handleReminderToggle,color:"#1890ff"},null,8,["checked","onChange"])]),_:1})]),_:1})]),_:1})]),_:1}),h(o,{class:"menu-section"},{default:t(()=>[h(o,{class:"menu-title"},{default:t(()=>[h(d,null,{default:t(()=>[k("æ•°æ®ç®¡ç†")]),_:1})]),_:1}),h(o,{class:"menu-list"},{default:t(()=>[h(o,{class:"menu-item",onClick:i.handleArchiveManagement},{default:t(()=>[h(o,{class:"menu-item-left"},{default:t(()=>[h(o,{class:"menu-icon",style:{"background-color":"#a463f2"}},{default:t(()=>[h(d,null,{default:t(()=>[k("ğŸ“¦")]),_:1})]),_:1}),h(d,{class:"menu-label"},{default:t(()=>[k("å½’æ¡£ç®¡ç†")]),_:1})]),_:1}),h(o,{class:"menu-item-right"},{default:t(()=>[h(d,{class:"menu-value"},{default:t(()=>[k(C(n.archivedCount)+"ä¸ª",1)]),_:1}),h(d,{class:"menu-arrow"},{default:t(()=>[k("â€º")]),_:1})]),_:1})]),_:1},8,["onClick"]),h(o,{class:"menu-item",onClick:i.handleDataManagement},{default:t(()=>[h(o,{class:"menu-item-left"},{default:t(()=>[h(o,{class:"menu-icon",style:{"background-color":"#39b54a"}},{default:t(()=>[h(d,null,{default:t(()=>[k("ğŸ’¾")]),_:1})]),_:1}),h(d,{class:"menu-label"},{default:t(()=>[k("æ•°æ®ç®¡ç†")]),_:1})]),_:1}),h(o,{class:"menu-item-right"},{default:t(()=>[h(d,{class:"menu-arrow"},{default:t(()=>[k("â€º")]),_:1})]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1}),h(o,{class:"menu-section"},{default:t(()=>[h(o,{class:"menu-title"},{default:t(()=>[h(d,null,{default:t(()=>[k("åº”ç”¨è®¾ç½®")]),_:1})]),_:1}),h(o,{class:"menu-list"},{default:t(()=>[h(o,{class:"menu-item",onClick:i.handleThemeSetting},{default:t(()=>[h(o,{class:"menu-item-left"},{default:t(()=>[h(o,{class:"menu-icon",style:{"background-color":"#52c4ff"}},{default:t(()=>[h(d,null,{default:t(()=>[k("ğŸ¨")]),_:1})]),_:1}),h(d,{class:"menu-label"},{default:t(()=>[k("ä¸»é¢˜è®¾ç½®")]),_:1})]),_:1}),h(o,{class:"menu-item-right"},{default:t(()=>[h(d,{class:"menu-value"},{default:t(()=>[k("è“ç™½ç³»")]),_:1}),h(d,{class:"menu-arrow"},{default:t(()=>[k("â€º")]),_:1})]),_:1})]),_:1},8,["onClick"]),h(o,{class:"menu-item",onClick:i.handleAbout},{default:t(()=>[h(o,{class:"menu-item-left"},{default:t(()=>[h(o,{class:"menu-icon",style:{"background-color":"#8799a3"}},{default:t(()=>[h(d,null,{default:t(()=>[k("â„¹ï¸")]),_:1})]),_:1}),h(d,{class:"menu-label"},{default:t(()=>[k("å…³äºæˆ‘ä»¬")]),_:1})]),_:1}),h(o,{class:"menu-item-right"},{default:t(()=>[h(d,{class:"menu-arrow"},{default:t(()=>[k("â€º")]),_:1})]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1}),h(o,{style:{height:"40rpx"}})]),_:1}),n.drawerVisible?(m(),a(o,{key:0,class:"drawer-mask",onClick:i.toggleDrawer},null,8,["onClick"])):_("",!0),h(o,{class:p(["drawer",{"drawer-open":n.drawerVisible}])},{default:t(()=>[h(o,{class:"drawer-header"},{default:t(()=>[h(d,{class:"drawer-title"},{default:t(()=>[k("å€’æ•°æœ¬")]),_:1}),h(o,{class:"drawer-close",onClick:i.toggleDrawer},{default:t(()=>[h(d,null,{default:t(()=>[k("âœ•")]),_:1})]),_:1},8,["onClick"])]),_:1}),h(I,{"scroll-y":"",class:"drawer-content"},{default:t(()=>[h(o,{class:"category-list"},{default:t(()=>[(m(!0),y(A,null,N(n.categories,e=>(m(),a(o,{key:e.id,class:"category-drawer-item",onClick:a=>i.handleCategoryClick(e)},{default:t(()=>[h(o,{class:"category-drawer-icon",style:S({backgroundColor:e.color})},{default:t(()=>[h(d,null,{default:t(()=>[k(C(e.icon),1)]),_:2},1024)]),_:2},1032,["style"]),h(d,{class:"category-drawer-name"},{default:t(()=>[k(C(e.name),1)]),_:2},1024),h(d,{class:"category-drawer-count"},{default:t(()=>[k(C(i.getCategoryCount(e.id)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1},8,["class"]),n.nicknameModalVisible?(m(),a(o,{key:1,class:"modal-mask",onClick:i.closeNicknameModal},{default:t(()=>[h(o,{class:"modal-content",onClick:l[1]||(l[1]=D(()=>{},["stop"]))},{default:t(()=>[h(o,{class:"modal-header"},{default:t(()=>[h(d,{class:"modal-title"},{default:t(()=>[k("ä¿®æ”¹æ˜µç§°")]),_:1}),h(o,{class:"modal-close",onClick:i.closeNicknameModal},{default:t(()=>[h(d,{class:"close-icon"},{default:t(()=>[k("âœ•")]),_:1})]),_:1},8,["onClick"])]),_:1}),h(o,{class:"modal-body"},{default:t(()=>[h(M,{class:"nickname-input",modelValue:n.newNickname,"onUpdate:modelValue":l[0]||(l[0]=e=>n.newNickname=e),placeholder:"è¯·è¾“å…¥æ–°æ˜µç§°",maxlength:"10"},null,8,["modelValue"])]),_:1}),h(o,{class:"modal-footer"},{default:t(()=>[h(o,{class:"btn btn-ghost",onClick:i.closeNicknameModal},{default:t(()=>[h(d,null,{default:t(()=>[k("å–æ¶ˆ")]),_:1})]),_:1},8,["onClick"]),h(o,{class:"btn btn-primary",onClick:i.saveNickname},{default:t(()=>[h(d,null,{default:t(()=>[k("ç¡®å®š")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onClick"])):_("",!0),n.archiveVisible?(m(),a(o,{key:2,class:"archive-mask",onClick:i.closeArchive},{default:t(()=>[h(o,{class:"archive-content",onClick:l[2]||(l[2]=D(()=>{},["stop"]))},{default:t(()=>[h(o,{class:"archive-header"},{default:t(()=>[h(d,{class:"archive-title"},{default:t(()=>[k("å½’æ¡£ç®¡ç†")]),_:1}),h(o,{class:"archive-close",onClick:i.closeArchive},{default:t(()=>[h(d,null,{default:t(()=>[k("âœ•")]),_:1})]),_:1},8,["onClick"])]),_:1}),h(I,{"scroll-y":"",class:"archive-body"},{default:t(()=>[n.archivedCountdowns.length>0?(m(),a(o,{key:0,class:"archived-list"},{default:t(()=>[(m(!0),y(A,null,N(n.archivedCountdowns,e=>(m(),a(o,{key:e.id,class:"archived-item shadow"},{default:t(()=>[h(o,{class:"archived-item-content"},{default:t(()=>[h(o,{class:"archived-item-left"},{default:t(()=>[h(o,{class:"archived-icon",style:S({backgroundColor:i.getCategoryColor(e.categoryId)})},{default:t(()=>[h(d,null,{default:t(()=>[k(C(i.getCategoryIcon(e.categoryId)),1)]),_:2},1024)]),_:2},1032,["style"]),h(o,{class:"archived-info"},{default:t(()=>[h(d,{class:"archived-title"},{default:t(()=>[k(C(e.title),1)]),_:2},1024),h(d,{class:"archived-date"},{default:t(()=>[k(C(i.formatDate(e.date)),1)]),_:2},1024),h(d,{class:"archived-category"},{default:t(()=>[k(C(i.getCategoryName(e.categoryId)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),h(o,{class:"archived-item-right"},{default:t(()=>[h(o,{class:"archived-btn",onClick:D(a=>i.handleUnarchive(e),["stop"])},{default:t(()=>[h(d,null,{default:t(()=>[k("æ¢å¤")]),_:1})]),_:2},1032,["onClick"]),h(o,{class:"archived-btn delete-btn",onClick:D(a=>i.handleDeleteArchived(e),["stop"])},{default:t(()=>[h(d,null,{default:t(()=>[k("åˆ é™¤")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(m(),a(o,{key:1,class:"empty-state"},{default:t(()=>[h(d,{class:"empty-icon"},{default:t(()=>[k("ğŸ“¦")]),_:1}),h(d,{class:"empty-text"},{default:t(()=>[k("ä¸æƒ³åœ¨ä¸»é¡µæ˜¾ç¤ºçš„æ—¥ç¨‹å¯ä»¥å½’æ¡£å“¦")]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1},8,["onClick"])):_("",!0)]),_:1})}],["__scopeId","data-v-2ae03894"]]);export{M as default};
