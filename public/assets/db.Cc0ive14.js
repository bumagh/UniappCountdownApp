import{B as t,z as e}from"./index-sFHZ-OT3.js";const a=new class{constructor(){this.data={users:[],categories:[],countdowns:[]},this.autoIncrementIds={users:1,categories:1,countdowns:1},this.init()}init(){try{const e=t("countdown_db");e?(this.data=JSON.parse(e),this.autoIncrementIds={users:Math.max(...this.data.users.map(t=>t.id),0)+1,categories:Math.max(...this.data.categories.map(t=>t.id),0)+1,countdowns:Math.max(...this.data.countdowns.map(t=>t.id),0)+1},this.migrateData()):this.initDefaultData()}catch(e){this.initDefaultData()}}migrateData(){let t=!1;const e=(new Date).toISOString();this.data.countdowns.forEach(a=>{void 0===a.isPinned&&(a.isPinned=!1,t=!0),void 0===a.repeatCycle&&(a.repeatCycle=0,t=!0),void 0===a.repeatFrequency&&(a.repeatFrequency="ä¸é‡å¤",t=!0),void 0===a.isArchived&&(a.isArchived=!1,t=!0),void 0===a.updatedAt&&(a.updatedAt=a.createdAt||e,t=!0)}),t&&this.save()}initDefaultData(){const t=(new Date).toISOString();this.data.users.push({id:1,nickname:"å¼ ä¸‰",avatar:"https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=200&h=200&fit=crop"}),this.autoIncrementIds.users=2;this.data.categories=[{id:1,name:"ç”Ÿæ´»",icon:"ğŸ ",color:"#1890ff",userId:1},{id:2,name:"å·¥ä½œ",icon:"ğŸ’¼",color:"#52c41a",userId:1},{id:3,name:"å®¶äºº",icon:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§",color:"#faad14",userId:1},{id:4,name:"é‡Œç¨‹ç¢‘",icon:"ğŸ¯",color:"#f5222d",userId:1}],this.autoIncrementIds.categories=5;const e=[{id:1,title:"æ˜¥èŠ‚",date:"2025-01-29",categoryId:1,userId:1,isPinned:!1,repeatCycle:0,repeatFrequency:"ä¸é‡å¤",isArchived:!1,createdAt:t,updatedAt:t},{id:2,title:"é¡¹ç›®æˆªæ­¢æ—¥",date:"2025-12-31",categoryId:2,userId:1,isPinned:!1,repeatCycle:0,repeatFrequency:"ä¸é‡å¤",isArchived:!1,createdAt:t,updatedAt:t},{id:3,title:"å¦ˆå¦ˆç”Ÿæ—¥",date:"2025-06-15",categoryId:3,userId:1,isPinned:!1,repeatCycle:0,repeatFrequency:"ä¸é‡å¤",isArchived:!1,createdAt:t,updatedAt:t}];this.data.countdowns=e,this.autoIncrementIds.countdowns=4,this.save()}save(){try{e("countdown_db",JSON.stringify(this.data))}catch(t){console.error("ä¿å­˜æ•°æ®å¤±è´¥:",t)}}getUser(t){return this.data.users.find(e=>e.id===t)}getCurrentUser(){return this.data.users[0]||null}updateUser(t,e){const a=this.data.users.findIndex(e=>e.id===t);return-1!==a?(this.data.users[a]={...this.data.users[a],...e},this.save(),this.data.users[a]):null}getCategories(t){return this.data.categories.filter(e=>e.userId===t)}getCategory(t){return this.data.categories.find(e=>e.id===t)}addCategory(t){const e={id:this.autoIncrementIds.categories++,...t,createdAt:(new Date).toISOString()};return this.data.categories.push(e),this.save(),e}updateCategory(t,e){const a=this.data.categories.findIndex(e=>e.id===t);return-1!==a?(this.data.categories[a]={...this.data.categories[a],...e},this.save(),this.data.categories[a]):null}deleteCategory(t){const e=this.data.categories.findIndex(e=>e.id===t);return-1!==e&&(this.data.categories.splice(e,1),this.data.countdowns=this.data.countdowns.filter(e=>e.categoryId!==t),this.save(),!0)}getCountdowns(t,e=null,a=!1){let s=this.data.countdowns.filter(e=>e.userId===t);return a||(s=s.filter(t=>!t.isArchived)),e&&(s=s.filter(t=>t.categoryId===e)),s.sort((t,e)=>t.isPinned&&e.isPinned?new Date(e.updatedAt)-new Date(t.updatedAt):t.isPinned&&!e.isPinned?-1:!t.isPinned&&e.isPinned?1:new Date(t.date)-new Date(e.date))}getArchivedCountdowns(t){return this.data.countdowns.filter(e=>e.userId===t&&e.isArchived)}getCountdown(t){return this.data.countdowns.find(e=>e.id===t)}addCountdown(t){const e=(new Date).toISOString(),a={id:this.autoIncrementIds.countdowns++,isPinned:!1,repeatCycle:0,repeatFrequency:"ä¸é‡å¤",isArchived:!1,createdAt:e,updatedAt:e,...t};return this.data.countdowns.push(a),this.save(),a}updateCountdown(t,e){const a=this.data.countdowns.findIndex(e=>e.id===t);return-1!==a?(this.data.countdowns[a]={...this.data.countdowns[a],...e,updatedAt:(new Date).toISOString()},this.save(),this.data.countdowns[a]):null}deleteCountdown(t){const e=this.data.countdowns.findIndex(e=>e.id===t);return-1!==e&&(this.data.countdowns.splice(e,1),this.save(),!0)}archiveCountdown(t){const e=this.data.countdowns.findIndex(e=>e.id===t);return-1!==e?(this.data.countdowns[e].isArchived=!0,this.data.countdowns[e].updatedAt=(new Date).toISOString(),this.save(),this.data.countdowns[e]):null}unarchiveCountdown(t){const e=this.data.countdowns.findIndex(e=>e.id===t);return-1!==e?(this.data.countdowns[e].isArchived=!1,this.data.countdowns[e].updatedAt=(new Date).toISOString(),this.save(),this.data.countdowns[e]):null}togglePin(t){const e=this.data.countdowns.findIndex(e=>e.id===t);return-1!==e?(this.data.countdowns[e].isPinned=!this.data.countdowns[e].isPinned,this.data.countdowns[e].updatedAt=(new Date).toISOString(),this.save(),this.data.countdowns[e]):null}getCountdownsByDate(t,e){return this.data.countdowns.filter(a=>a.userId===t&&a.date===e&&!a.isArchived)}calculateDays(t){const e=new Date;e.setHours(0,0,0,0);const a=new Date(t);a.setHours(0,0,0,0);const s=a-e;return Math.ceil(s/864e5)}getNextRepeatDate(t,e,a){if(0===e||"ä¸é‡å¤"===a)return t;const s=new Date;s.setHours(0,0,0,0);let n=new Date(t);if(n.setHours(0,0,0,0),n>s)return t;for(;n<=s;)switch(a){case"å¤©é‡å¤":n.setDate(n.getDate()+e);break;case"å‘¨é‡å¤":n.setDate(n.getDate()+7*e);break;case"æœˆé‡å¤":n.setMonth(n.getMonth()+e);break;case"å¹´é‡å¤":n.setFullYear(n.getFullYear()+e)}return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`}getCountdownDisplayDate(t){return t.repeatCycle>0&&"ä¸é‡å¤"!==t.repeatFrequency?this.getNextRepeatDate(t.date,t.repeatCycle,t.repeatFrequency):t.date}formatDate(t){const e=new Date(t);return`${e.getFullYear()}å¹´${e.getMonth()+1}æœˆ${e.getDate()}æ—¥ æ˜ŸæœŸ${["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"][e.getDay()]}`}getRepeatText(t,e){return 0===t||"ä¸é‡å¤"===e?"ä¸é‡å¤":`æ¯${t}${e}`}clearAll(){this.data={users:[],categories:[],countdowns:[]},this.autoIncrementIds={users:1,categories:1,countdowns:1},this.save()}};export{a as d};
